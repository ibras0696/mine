# Управление правами администратора и "читами"

Эта памятка описывает, как включить серверные "читы" (команды оператора), выдать/отобрать OP-статус и какие настройки прав лучше держать под контролем.

## 1. Что считать "читами" на сервере

На выделенном сервере Minecraft все привилегированные команды (телепорт, spawn предметов и т.п.) доступны только игрокам с OP-правами. Флаг `allow-cheats` даёт операторам доступ к командам без дополнительных ограничений. Без OP ни один игрок не сможет выполнить команду `/gamemode`, `/give` и т.д.

## 2. Включаем `allow-cheats`

### Через `.env`

В образе `itzg/minecraft-server` достаточно переключить переменную `ALLOW_CHEATS`:

```
ALLOW_CHEATS=true
```

Добавь строку в файл `.env` (рядом с `MEMORY`, `MODE` и т.п.). После изменения перезапусти сервер:

```bash
make up
```

При запуске в логах появится строка `allow-cheats=true`.

### Через `server.properties`

Если нужно изменить параметр вручную, открой `data/server.properties` и установи:

```
allow-cheats=true
```

После сохранения файла перезапусти сервер (`make restart`).

## 3. Как выдать OP игроку

### Вариант A: командой из контейнера

```bash
cd ~/mc-forge/files-3
docker compose exec mc mc-send-to-console "op <ник>"
```

- `<ник>` — точное имя игрока.
- Команда мгновенно добавит запись в `ops.json`.

### Вариант B: через интерактивную консоль

```bash
cd ~/mc-forge/files-3
docker compose exec -it mc bash
# внутри контейнера
mc@container:/data$ mc-send-to-console "op <ник>"
```

Можно также набрать `op <ник>` в самой консоли сервера, если она уже открыта (`make logs -f` и переключиться в окно).

### Вариант C: редактирование `ops.json`

1. Останови сервер: `make stop`.
2. Открой `data/ops.json` и добавь запись вида:
   ```json
   [
     {
       "uuid": "<UUID игрока>",
       "name": "<ник>",
       "level": 4,
       "bypassesPlayerLimit": false
     }
   ]
   ```
3. Запусти сервер: `make start`.

UUID можно посмотреть на сайтах типа [mcuuid.net](https://mcuuid.net/).

## 4. Снимаем OP-статус

Команда обратная выдаче:

```bash
cd ~/mc-forge/files-3
docker compose exec mc mc-send-to-console "deop <ник>"
```

Или удали соответствующую запись из `data/ops.json` (не забудь остановить сервер перед правкой).

## 5. Частые сценарии

| Задача | Действие |
|--------|----------|
| Включить "читы" глобально | `ALLOW_CHEATS=true` в `.env` → `make up` |
| Выдать себе права | `docker compose exec mc mc-send-to-console "op МойНик"` |
| Снять права у игрока | `docker compose exec mc mc-send-to-console "deop Ник"` |
| Запретить всем командам работать | `ALLOW_CHEATS=false`, удалить записи из `ops.json`, перезапустить |

## 6. Безопасность

- Не делай OP-права всем подряд. Даже с отключённым `ONLINE_MODE` держи whitelist.
- Следи за содержимым `ops.json` — оно лежит в `./data`, можно поставить под git- или файловый контроль.
- Если игроки подключаются через Radmin/ZeroTier, меняй пароли сетей и whitelist одновременно.

---

Теперь у тебя есть готовые команды и место для заметок. При желании можешь расширить документ своими правилами (напр. кто имеет какое право или как часто менять пароли).