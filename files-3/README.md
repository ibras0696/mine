# Minecraft Forge 1.20.1 — автономный сервер

Готовый комплект для запуска модифицированного сервера Minecraft Forge 1.20.1 на одном VPS. Всё собрано вокруг Docker Compose и Makefile, поэтому администрирование сводится к нескольким командам.

## Что входит
- `Dockerfile` с фиксированной версией Forge, дополнительными проверками каталога `/data` и полезными утилитами.
- `docker-compose.yml` с healthcheck и автоматическим перезапуском контейнера.
- Makefile-таргеты для развёртывания, обновлений и просмотра логов.
- Скрипты `scripts/setup_host.sh` и `scripts/mc-console.sh`, упрощающие подготовку VPS и отправку команд на сервер.
- Документация в `docs/` с памятками по настройке геймплея, VPN и выдаче прав.

## Минимальные требования
- Ubuntu Server 24.04 LTS (чистая установка).
- 2 vCPU, 6 ГБ RAM, SSD 20+ ГБ.
- Доступ по SSH с правами sudo.
- Открытый порт 25565 (или любой другой, указанный в `.env`).

## Быстрый старт (Ubuntu 24.04)
1. Склонировать проект или загрузить архив на сервер (в примерах используется `~/mc-forge`).
2. Запустить подготовку хоста:
   ```bash
   cd ~/mc-forge/files-3
   chmod +x scripts/setup_host.sh
   ./scripts/setup_host.sh
   ```
3. После повторного входа в SSH настроить каталог данных и `.env`:
   ```bash
   make configure        # создаст data/ и .env (если его нет)
   nano .env             # отредактируй значения под себя
   ```
4. Собрать образ и поднять стек:
   ```bash
   make build
   make up
   make logs             # убедись, что сервер инициализировался и слушает порт
   ```
5. Подключиться к серверу по IP VPS и порту из `.env` (по умолчанию 25565).

## Подробная настройка с нуля
1. **Подготовка системы** — см. скрипт `scripts/setup_host.sh`. Он ставит Docker Engine, Compose plugin и добавляет пользователя в группу `docker`.
2. **Клонирование проекта**:
   ```bash
   git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ> ~/mc-forge
   cd ~/mc-forge/files-3
   ```
3. **Создание `.env`**. Выполни `make configure`, затем открой файл и поменяй минимум эти параметры:
   - `SERVER_NAME` — отображаемое имя сервера.
   - `LEVEL` — имя мира (будет создан в `data/my_world`).
   - `MODE`, `DIFFICULTY`, `MAX_PLAYERS` — геймплейные настройки.
   - `ONLINE_MODE` и `WHITELIST` — безопасность и whitelisted режим.
4. **Запуск** — `make build` (первичная сборка образа) и `make up`. Контейнер сам подтянет моды из `data/mods` и конфиги из `data/config`.
5. **Проверка** — `make status` и `make logs`. При необходимости используй `scripts/mc-console.sh "time set day"` для отправки команд.

## Структура проекта
```
files-3/
├─ Dockerfile              # пользовательский образ на базе itzg/minecraft-server
├─ docker-compose.yml      # запуск контейнера minecraft
├─ Makefile                # сценарии управления
├─ .env.example            # шаблон конфигурации
├─ data/                   # постоянные данные (мир, моды, конфиги, логи)
├─ docs/                   # справочные материалы
└─ scripts/
   ├─ setup_host.sh        # подготовка Ubuntu 24.04
   ├─ mc-console.sh        # отправка команд на консоль
   └─ container/           # вспомогательные скрипты внутри образа
```

## Основные переменные `.env`
| Переменная | Назначение |
|-----------|------------|
| `SERVER_NAME` | имя сервера в списке клиентов |
| `VERSION`, `FORGE_VERSION` | версию Minecraft и Forge не меняй без обновления модов |
| `MEMORY` | лимит RAM контейнера (`6G` для 5 игроков) |
| `LEVEL`, `LEVEL_TYPE`, `SEED` | параметры создаваемого мира |
| `MODE`, `DIFFICULTY`, `ALLOW_CHEATS`, `FORCE_GAMEMODE` | базовые правила игры |
| `MAX_PLAYERS`, `VIEW_DISTANCE`, `SIMULATION_DISTANCE` | нагрузка и ограничения сервера |
| `ONLINE_MODE`, `WHITELIST`, `OPS` | безопасность, список допущенных игроков и операторов |
| `PUBLISHED_PORT` | внешний порт, который прокинет Docker |
| `TIMEZONE`, `RADMIN_VPN_IP` | служебные и вспомогательные параметры |

Все остальные настройки подробно описаны в `docs/SERVER_SETTINGS.md`.

## Makefile и скрипты
| Команда | Действие |
|---------|----------|
| `make configure` | создаёт директории `data/*` и копирует `.env.example` в `.env`, если его ещё нет |
| `make build` | собирает локальный образ `mc-forge:1.20.1` с нашими скриптами |
| `make up` / `make down` | старт/остановка стека в фоне |
| `make restart`, `make stop`, `make start` | управление уже созданным контейнером |
| `make logs`, `make status` | просмотр логов и статуса контейнера |
| `make pull` | обновление базового образа `itzg/minecraft-server` |
| `scripts/mc-console.sh "оп"` | отправка любой консольной команды на сервер |

## Полезные советы
- Все данные живут в `data/`. Перед любыми экспериментами копируй мир `data/my_world`.
- Логи из `data/logs` удобно просматривать через `tail -f data/logs/latest.log` прямо на VPS.
- Для VPN-подключения без проброса портов см. `docs/vpn/RADMIN.md` (ZeroTier/Radmin VPN).
- Если контейнер не поднимается, сначала выполни `docker compose ps` и `docker compose logs mc`, а затем проверь переменные в `.env`.

Всё готово: после настройки `.env` достаточно запускать `make up`, и сервер будет автоматически подниматься после перезагрузки VPS благодаря Docker.

